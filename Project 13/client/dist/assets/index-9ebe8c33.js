(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();function Z(e){return e}function X(e){return e.length===0?Z:e.length===1?e[0]:function(t){return e.reduce((r,o)=>o(r),t)}}function L(e){const n={subscribe(t){let r=null,o=!1,i=!1,c=!1;function u(){if(r===null){c=!0;return}i||(i=!0,typeof r=="function"?r():r&&r.unsubscribe())}return r=e({next(s){var l;o||(l=t.next)==null||l.call(t,s)},error(s){var l;o||(o=!0,(l=t.error)==null||l.call(t,s),u())},complete(){var s;o||(o=!0,(s=t.complete)==null||s.call(t),u())}}),c&&u(),{unsubscribe:u}},pipe(...t){return X(t)(n)}};return n}function ee(e){return n=>{let t=0,r=null;const o=[];function i(){r||(r=n.subscribe({next(u){var s;for(const l of o)(s=l.next)==null||s.call(l,u)},error(u){var s;for(const l of o)(s=l.error)==null||s.call(l,u)},complete(){var u;for(const s of o)(u=s.complete)==null||u.call(s)}}))}function c(){if(t===0&&r){const u=r;r=null,u.unsubscribe()}}return{subscribe(u){return t++,o.push(u),i(),{unsubscribe(){t--,c();const s=o.findIndex(l=>l===u);s>-1&&o.splice(s,1)}}}}}}class D extends Error{constructor(n){super(n),this.name="ObservableAbortError",Object.setPrototypeOf(this,D.prototype)}}function te(e){let n;return{promise:new Promise((r,o)=>{let i=!1;function c(){i||(i=!0,o(new D("This operation was aborted.")),u.unsubscribe())}const u=e.subscribe({next(s){i=!0,r(s),c()},error(s){i=!0,o(s),c()},complete(){i=!0,c()}});n=c}),abort:n}}function W(e){return L(n=>{function t(o=0,i=e.op){const c=e.links[o];if(!c)throw new Error("No more links to execute - did you forget to add an ending link?");return c({op:i,next(s){return t(o+1,s)}})}return t().subscribe(n)})}function H(e){return Array.isArray(e)?e:[e]}function ne(e){return n=>{const t=H(e.true).map(o=>o(n)),r=H(e.false).map(o=>o(n));return o=>L(i=>{const c=e.condition(o.op)?t:r;return W({op:o.op,links:c}).subscribe(i)})}}function re(e){return e instanceof P||e.name==="TRPCClientError"}class P extends Error{static from(n,t={}){return n instanceof Error?re(n)?(t.meta&&(n.meta={...n.meta,...t.meta}),n):new P(n.message,{...t,cause:n,result:null}):new P(n.error.message??"",{...t,cause:void 0,result:n})}constructor(n,t){var o,i;const r=t==null?void 0:t.cause;super(n,{cause:r}),this.meta=t==null?void 0:t.meta,this.cause=r,this.shape=(o=t==null?void 0:t.result)==null?void 0:o.error,this.data=(i=t==null?void 0:t.result)==null?void 0:i.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,P.prototype)}}function v(e){const n=Object.create(null);for(const t in e){const r=e[t];n[r]=t}return n}const B={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};v(B);v(B);const J=()=>{};function K(e,n){return new Proxy(J,{get(r,o){if(!(typeof o!="string"||o==="then"))return K(e,[...n,o])},apply(r,o,i){const c=n[n.length-1]==="apply";return e({args:c?i.length>=2?i[1]:[]:i,path:c?n.slice(0,-1):n})}})}const oe=e=>K(e,[]),ie=e=>new Proxy(J,{get(n,t){if(!(typeof t!="string"||t==="then"))return e(t)}}),$=e=>typeof e=="function";function ce(e){if(e)return e;if(typeof window<"u"&&$(window.fetch))return window.fetch;if(typeof globalThis<"u"&&$(globalThis.fetch))return globalThis.fetch;throw new Error("No fetch implementation found")}function se(e){return e||(typeof window<"u"&&window.AbortController?window.AbortController:typeof globalThis<"u"&&globalThis.AbortController?globalThis.AbortController:null)}function ue(e){return{url:e.url,fetch:e.fetch,AbortController:se(e.AbortController)}}function le(e){const n={};for(let t=0;t<e.length;t++){const r=e[t];n[t]=r}return n}const ae={query:"GET",mutation:"POST"};function Y(e){return"input"in e?e.runtime.transformer.serialize(e.input):le(e.inputs.map(n=>e.runtime.transformer.serialize(n)))}const G=e=>{let n=e.url+"/"+e.path;const t=[];if("inputs"in e&&t.push("batch=1"),e.type==="query"){const r=Y(e);r!==void 0&&t.push(`input=${encodeURIComponent(JSON.stringify(r))}`)}return t.length&&(n+="?"+t.join("&")),n},fe=e=>{if(e.type==="query")return;const n=Y(e);return n!==void 0?JSON.stringify(n):void 0},de=e=>he({...e,contentTypeHeader:"application/json",getUrl:G,getBody:fe});async function me(e,n){const t=e.getUrl(e),r=e.getBody(e),{type:o}=e,i=await e.headers();/* istanbul ignore if -- @preserve */if(o==="subscription")throw new Error("Subscriptions should use wsLink");const c={...e.contentTypeHeader?{"content-type":e.contentTypeHeader}:{},...e.batchModeHeader?{"trpc-batch-mode":e.batchModeHeader}:{},...i};return ce(e.fetch)(t,{method:ae[o],signal:n==null?void 0:n.signal,body:r,headers:c})}function he(e){const n=e.AbortController?new e.AbortController:null,t={};return{promise:new Promise((i,c)=>{me(e,n).then(u=>(t.response=u,u.json())).then(u=>{t.responseJSON=u,i({json:u,meta:t})}).catch(u=>{c(P.from(u,{meta:t}))})}),cancel:()=>{n==null||n.abort()}}}function F(e){return!!e&&!Array.isArray(e)&&typeof e=="object"}function pe(e,n){if("error"in e){const r=n.transformer.deserialize(e.error);return{ok:!1,error:{...e,error:r}}}return{ok:!0,result:{...e.result,...(!e.result.type||e.result.type==="data")&&{type:"data",data:n.transformer.deserialize(e.result.data)}}}}class j extends Error{constructor(){super("Unable to transform response from server")}}function Q(e,n){let t;try{t=pe(e,n)}catch{throw new j}if(!t.ok&&(!F(t.error.error)||typeof t.error.error.code!="number"))throw new j;if(t.ok&&!F(t.result))throw new j;return t}const k=()=>{throw new Error("Something went wrong. Please submit an issue at https://github.com/trpc/trpc/issues/new")};function q(e){let n=null,t=null;const r=()=>{clearTimeout(t),t=null,n=null};function o(u){var y,f;const s=[[]];let l=0;for(;;){const a=u[l];if(!a)break;const h=s[s.length-1];if(a.aborted){(y=a.reject)==null||y.call(a,new Error("Aborted")),l++;continue}if(e.validate(h.concat(a).map(d=>d.key))){h.push(a),l++;continue}if(h.length===0){(f=a.reject)==null||f.call(a,new Error("Input is too big for a single dispatch")),l++;continue}s.push([])}return s}function i(){const u=o(n);r();for(const s of u){if(!s.length)continue;const l={items:s,cancel:k};for(const h of s)h.batch=l;const y=(h,g)=>{var w;const d=l.items[h];(w=d.resolve)==null||w.call(d,g),d.batch=null,d.reject=null,d.resolve=null},{promise:f,cancel:a}=e.fetch(l.items.map(h=>h.key),y);l.cancel=a,f.then(h=>{var g;for(let d=0;d<h.length;d++){const w=h[d];y(d,w)}for(const d of l.items)(g=d.reject)==null||g.call(d,new Error("Missing result")),d.batch=null}).catch(h=>{var g;for(const d of l.items)(g=d.reject)==null||g.call(d,h),d.batch=null})}}function c(u){const s={aborted:!1,key:u,batch:null,resolve:k,reject:k},l=new Promise((f,a)=>{s.reject=a,s.resolve=f,n||(n=[]),n.push(s)});return t||(t=setTimeout(i)),{promise:l,cancel:()=>{var f;s.aborted=!0,(f=s.batch)!=null&&f.items.every(a=>a.aborted)&&(s.batch.cancel(),s.batch=null)}}}return{load:c}}function ye(e){return function(t){const r=ue(t),o=t.maxURLLength??1/0;return i=>{const c=f=>{const a=g=>{if(o===1/0)return!0;const d=g.map(R=>R.path).join(","),w=g.map(R=>R.input);return G({...r,runtime:i,type:f,path:d,inputs:w}).length<=o},h=e({...r,runtime:i,type:f,opts:t});return{validate:a,fetch:h}},u=q(c("query")),s=q(c("mutation")),l=q(c("subscription")),y={query:u,subscription:l,mutation:s};return({op:f})=>L(a=>{const h=y[f.type],{promise:g,cancel:d}=h.load(f);let w;return g.then(E=>{w=E;const R=Q(E.json,i);if(!R.ok){a.error(P.from(R.error,{meta:E.meta}));return}a.next({context:E.meta,result:R.result}),a.complete()}).catch(E=>{a.error(P.from(E,{meta:w==null?void 0:w.meta}))}),()=>{d()}})}}}const be=e=>n=>{const t=n.map(c=>c.path).join(","),r=n.map(c=>c.input),{promise:o,cancel:i}=de({...e,path:t,inputs:r,headers(){return e.opts.headers?typeof e.opts.headers=="function"?e.opts.headers({opList:n}):e.opts.headers:{}}});return{promise:o.then(c=>(Array.isArray(c.json)?c.json:n.map(()=>c.json)).map(l=>({meta:c.meta,json:l}))),cancel:i}},ge=ye(be);/* istanbul ignore next -- @preserve */const we=e=>e===0?0:Math.min(1e3*2**e,3e4);function Te(e){const{url:n,WebSocket:t=WebSocket,retryDelayMs:r=we,onOpen:o,onClose:i}=e;/* istanbul ignore next -- @preserve */if(!t)throw new Error("No WebSocket implementation found - you probably don't want to use this on the server, but if you do you need to pass a `WebSocket`-ponyfill");let c=[];const u=Object.create(null);let s=0,l=null,y=null,f=z(),a="connecting";function h(){a!=="open"||l||(l=setTimeout(()=>{l=null,c.length===1?f.send(JSON.stringify(c.pop())):f.send(JSON.stringify(c)),c=[]}))}function g(){if(y!==null||a==="closed")return;const p=r(s++);w(p)}function d(){a="connecting";const p=f;f=z(),E(p)}function w(p){y||(a="connecting",y=setTimeout(d,p))}function E(p){Object.values(u).some(N=>N.ws===p)||p.close()}function R(){Object.values(u).forEach(p=>{p.type==="subscription"&&p.callbacks.complete()})}function U(p){c.some(b=>b.id===p.op.id)||M(p.op,p.callbacks)}function z(){const p=typeof n=="function"?n():n,b=new t(p);clearTimeout(y),y=null,b.addEventListener("open",()=>{/* istanbul ignore next -- @preserve */b===f&&(s=0,a="open",o==null||o(),h())}),b.addEventListener("error",()=>{b===f&&g()});const N=T=>{if(T.method==="reconnect"&&b===f){a==="open"&&(i==null||i()),d();for(const m of Object.values(u))m.type==="subscription"&&U(m)}},I=T=>{var x,O;const m=T.id!==null&&u[T.id];if(m){if((O=(x=m.callbacks).next)==null||O.call(x,T),m.ws!==f&&b===f){const S=m.ws;m.ws=f,E(S)}"result"in T&&T.result.type==="stopped"&&b===f&&m.callbacks.complete()}};return b.addEventListener("message",({data:T})=>{const m=JSON.parse(T);"method"in m?N(m):I(m),(b!==f||a==="closed")&&E(b)}),b.addEventListener("close",({code:T})=>{var m,x,O,S;a==="open"&&(i==null||i({code:T})),f===b&&g();for(const[C,A]of Object.entries(u))if(A.ws===b){if(a==="closed"){delete u[C],(x=(m=A.callbacks).complete)==null||x.call(m);continue}A.type==="subscription"?U(A):(delete u[C],(S=(O=A.callbacks).error)==null||S.call(O,P.from(new _("WebSocket closed prematurely"))))}}),b}function M(p,b){const{type:N,input:I,path:T,id:m}=p,x={id:m,method:N,params:{input:I,path:T}};return u[m]={ws:f,type:N,callbacks:b,op:p},c.push(x),h(),()=>{var S,C;const O=(S=u[m])==null?void 0:S.callbacks;delete u[m],c=c.filter(A=>A.id!==m),(C=O==null?void 0:O.complete)==null||C.call(O),f.readyState===t.OPEN&&p.type==="subscription"&&(c.push({id:m,method:"subscription.stop"}),h())}}return{close:()=>{a="closed",i==null||i(),R(),E(f),clearTimeout(y),y=null},request:M,getConnection(){return f}}}class _ extends Error{constructor(n){super(n),this.name="TRPCWebSocketClosedError",Object.setPrototypeOf(this,_.prototype)}}function Ee(e){return n=>{const{client:t}=e;return({op:r})=>L(o=>{const{type:i,path:c,id:u,context:s}=r,l=n.transformer.serialize(r.input),y=t.request({type:i,path:c,input:l,id:u,context:s},{error(f){o.error(f),y()},complete(){o.complete()},next(f){const a=Q(f,n);if(!a.ok){o.error(P.from(a.error));return}o.next({result:a.result}),r.type!=="subscription"&&(y(),o.complete())}});return()=>{y()}})}}class Oe{$request({type:n,input:t,path:r,context:o={}}){return W({links:this.links,op:{id:++this.requestId,type:n,path:r,input:t,context:o}}).pipe(ee())}requestAsPromise(n){const t=this.$request(n),{promise:r,abort:o}=te(t);return new Promise((c,u)=>{var s;(s=n.signal)==null||s.addEventListener("abort",o),r.then(l=>{c(l.result.data)}).catch(l=>{u(P.from(l))})})}query(n,t,r){return this.requestAsPromise({type:"query",path:n,input:t,context:r==null?void 0:r.context,signal:r==null?void 0:r.signal})}mutation(n,t,r){return this.requestAsPromise({type:"mutation",path:n,input:t,context:r==null?void 0:r.context,signal:r==null?void 0:r.signal})}subscription(n,t,r){return this.$request({type:"subscription",path:n,input:t,context:r==null?void 0:r.context}).subscribe({next(i){var c,u,s;i.result.type==="started"?(c=r.onStarted)==null||c.call(r):i.result.type==="stopped"?(u=r.onStopped)==null||u.call(r):(s=r.onData)==null||s.call(r,i.result.data)},error(i){var c;(c=r.onError)==null||c.call(r,i)},complete(){var i;(i=r.onComplete)==null||i.call(r)}})}constructor(n){this.requestId=0;const t=(()=>{const r=n.transformer;return r?"input"in r?n.transformer:{input:r,output:r}:{input:{serialize:o=>o,deserialize:o=>o},output:{serialize:o=>o,deserialize:o=>o}}})();this.runtime={transformer:{serialize:r=>t.input.serialize(r),deserialize:r=>t.output.deserialize(r)},combinedTransformer:t},this.links=n.links.map(r=>r(this.runtime))}}const Pe={query:"query",mutate:"mutation",subscribe:"subscription"},Re=e=>Pe[e];function xe(e){return ie(n=>e.hasOwnProperty(n)?e[n]:n==="__untypedClient"?e:oe(({path:t,args:r})=>{const o=[n,...t],i=Re(o.pop()),c=o.join(".");return e[i](c,...r)}))}function Se(e){const n=new Oe(e);return xe(n)}const Ae=Te({url:"ws://localhost:3000/trpc"}),V=Se({links:[ne({condition:e=>e.type==="subscription",true:Ee({client:Ae}),false:ge({url:"http://localhost:3000/trpc",headers:{Aurhorization:"TOKEN"}})})]});document.addEventListener("click",()=>{V.updateUser.mutate({userId:"341",name:"Kely"})});async function Ne(){V.users.onUpdate.subscribe(void 0,{onData:e=>console.log("Updated",e)})}Ne();
